<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>RPG Game</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">  
</head>
<body>
    <div id="wrapper">


        <!-- ==============CHARACTER SELECTION============== -->

        <div id="heroSelect" class="gameArea"></div>

        <!-- ==============OPPONENT SELECTION============== -->

        <div id="enemySelect" class="gameArea"></div>

        <!-- ==============OPPONENT ENCOUNTER============== -->

        <div id="encounter" class="gameArea"></div>

        <!-- ==============BATTLE============== -->
        
        <div id="arena" class="gameArea">
            <div>
                <h3 id="enemyHP">HP: </h3> 
                <progress id="enemyHPBar"></progress>
                <img id="enemyImg">
                <img id="enemyDMG">

            </div>
            <div>
                <h3 id="heroHP">HP: </h3>
                <progress id="heroHPBar"></progress>
                <img id="heroImg">
                <img id="heroDMG">
                <button id="attack-btn" class="on">ATTACK</button>
                <h4 id="narrator"></h4>
            </div>
        </div>

        <!-- ==============RESULTS============== -->

        <div id="winOrLose" class="gameArea"></div>

        <!-- ==============JAVASCRIPT============== -->

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        
        var characterBulbasaur = {
            name: "Bulbasaur",
            hitPoints: 100,
            currentHitPoints: 100,  
            attackPower: 5,        
            baseAttackIncrement: 10,  
            counterAttack: 10,       
            chosenOrDefeated: false,
            difficulty: "Easy",       
            frontImg: "assets/images/bulbasaur1.gif",
            backImg: "assets/images/bulbasaur2.gif",
            profImg: "assets/images/bulbasaur-profile.png"
        };

        var characterPorygon2 = {
            name: "Porygon2",
            hitPoints: 130,
            currentHitPoints: 130,  
            attackPower: 10,        
            baseAttackIncrement: 12,     
            counterAttack: 15,          
            chosenOrDefeated: false,
            difficulty: "Hard",      
            frontImg: "assets/images/porygon21.gif",
            backImg: "assets/images/porygon22.gif",
            profImg: "assets/images/porygon2-profile.png",
        };

        var characterGengar = {
            name: "Gengar",
            hitPoints: 170,
            currentHitPoints: 170,   
            attackPower: 14,         
            baseAttackIncrement: 20,     
            counterAttack: 20,          
            chosenOrDefeated: false,
            difficulty: "Very Hard",       
            frontImg: "assets/images/gengar1.gif",
            backImg: "assets/images/gengar2.gif",
            profImg: "assets/images/gengar-profile.png"
        };

        var characterMewtwo = {
            name: "Mewtwo",
            hitPoints: 200,
            currentHitPoints: 200,   
            attackPower: 18,         
            baseAttackIncrement: 28,    
            counterAttack: 25,         
            chosenOrDefeated: false,
            difficulty: "Master",
            frontImg: "assets/images/mewtwo1.gif",
            backImg: "assets/images/mewtwo2.gif",
            profImg: "assets/images/mewtwo-profile.png"
        };

        var char = [];
        char[0] = characterBulbasaur;
        char[1] = characterPorygon2;
        char[2] = characterGengar;
        char[3] = characterMewtwo;
        var enemyChar;
        var heroChar;
        var getHero;
        var unlistHero;
        var getOpponent;  
        var challenge;
        var battle;
        var startTurn;
        var hideScenes;
        var lossCheck;
        var beatEnemyCheck;
        var winCheck;
   

        hideScenes = function() {
            $("#heroSelect").addClass('hidden');
            $("#enemySelect").addClass('hidden'); 
            $("#encounter").addClass('hidden');
            $("#arena").addClass('hidden');
            $("#winOrLose").addClass('hidden');
        }


        getHero = function() {
            hideScenes();
            $('#heroSelect').html("<h1>Choose your Pokemon!</h1>");
            $('#heroSelect').removeClass('hidden');
            
            for (var i = 0; i <= 3; i++) {
                var hero = $("<img>");
                hero.addClass("heroes");
                hero.attr('src', char[i].profImg);
                hero.attr('width', "130px");
                hero.attr('height', "130px");
                hero.attr('id', 'heroID' + i);
                $("#heroSelect").append(hero);
            }

            $("#heroID0").on("click", function() {
                heroChar = char[0];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent();
                return heroChar;
            });

            $("#heroID1").on("click", function() {
                heroChar = char[1];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent();
                return heroChar;
            });

            $("#heroID2").on("click", function() {
                heroChar = char[2];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent();
                return heroChar;
            });

            $("#heroID3").on("click", function() {
                heroChar = char[3];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent();
                return heroChar;
            });
        }

        getOpponent = function(HP) {
            $("#heroHPBar").attr("value", HP);
            hideScenes();
            $('#enemySelect').html("<h1>Choose an opponent!</h1>");
            $('#enemySelect').removeClass('hidden');
            for (var i = 0; i <= 3; i++) {
                if (char[i].chosenOrDefeated == false){
                    var enemy = $("<img>");
                    enemy.addClass('enemies');
                    enemy.attr('src', char[i].profImg);
                    enemy.attr('width', "130px");
                    enemy.attr('height', "130px");
                    enemy.attr('id', 'enemyID' + i);
                    $("#enemySelect").append(enemy);
                }
            }     

            $("#enemyID0").on("click", function() {
                enemyChar = char[0];
                // alert("Your enemy is " + enemyChar.name + "!");
                hideScenes();
                challenge();
                return enemyChar;
            });

            $("#enemyID1").on("click", function() {
                enemyChar = char[1];
                // alert("Your enemy is " + enemyChar.name + "!");
                hideScenes();
                challenge();
                return enemyChar;
            });

            $("#enemyID2").on("click", function() {
                enemyChar = char[2];
                // alert("Your enemy is " + enemyChar.name + "!");
                hideScenes();
                challenge();
                return enemyChar;
            });

            $("#enemyID3").on("click", function() {
                enemyChar = char[3];
                // alert("Your enemy is " + enemyChar.name + "!");
                hideScenes();
                challenge();
                return enemyChar;
            });
        }

        challenge = function() {
            $('#enemySelect').html('');
            $('#encounter').html("<h1 id='encounterWords'></h1><br><img id='encounterImg'>")
            $('#encounter').removeClass('hidden');
            $('#encounterWords').append("Enemy " + enemyChar.name + " challenges you!");
            $('#encounterImg').attr("src", enemyChar.profImg);
            $('#encounterImg').after("<br><br><br><br><h1 id='encounterWords'>Click anywhere to battle!</h1>");
            $("#encounter").on("click", function() {
                hideScenes();
                battle();
            });
        }

// DO THIS FOR DAMAGE ON CHARACTERS
        // $( "#foo" ).slideUp( 300 ).delay( 800 ).fadeIn( 400 );

        battle = function(){
            $("#encounter").html("");
            $('#arena').removeClass('hidden');
            $("#enemyImg").attr("src", enemyChar.frontImg);
            $("#heroImg").attr("src", heroChar.backImg);

            //add this back in later*
            // $("#enemyHP").prepend("Enemy " + enemyChar.name +  "\'s ").append(enemyChar.currentHitPoints).append("/").append(enemyChar.hitPoints);
            // $("#heroHP").prepend(heroChar.name +  "\'s ").append(heroChar.currentHitPoints).append("/").append(heroChar.hitPoints);

                //this populates the HP bars 

            $("#heroHPBar").attr("max", heroChar.hitPoints);
            $("#heroHPBar").attr("value", heroChar.currentHitPoints);
            $("#enemyHPBar").attr("max", enemyChar.hitPoints);
            $("#enemyHPBar").attr("value", enemyChar.currentHitPoints);
// ====================================================================================================



// I tried for so long to get the timeout be a variable that I could clear. But all I could ever do was make 
// it anonymous, so I think I never cleared it. 

// When I tried to console.log the timer, or the setTimeout, or anything else, it would increment by 8 or 9 each execution
// of the onclick event. The whole thing does not take 8 or 9 secconds, and I was expecting it to be in milliseconds, 
// so it seems like it  was showing something else. I finally gave up but I eventually go it to work with a fix. 

// The problem is that the lossCheck() would keep running even after a win condition was satisfied. So on many cases, it 
// would not matter. But if the hero's HP was low enough that a counter-attack would kill him -- even after killing the 
// current opponent -- the hero would die, too. 

// My fix was that if the opponent's HP is <= zero, the counter-attack will go through, BUT I add back the HP that 
// the hero lost. It's not perfect, and I will fix the timeouts. 

                    //             var seconds=0;
                    //             var timerName;
                    //             var timecount=0;
                    // // ======================================================================    
                    //             function timeCount()
                    //             {
                    //                 document.getElementById('heroHP').value=seconds;
                    //                 seconds=seconds+1;
                    //                 timeName=setTimeout("timeCount()",1000);
                    //                     //every 1000ms, add another counter to "seconds"
                    //             }
                    // // ======================================================================
                    //             function startTimer()
                    //             {
                    //                 if (!timecount)
                    //                 {
                    //                     timecount=1;
                    //                     timeCount();
                    //             }
                    // // ======================================================================
                    //             $("#attack-btn").on("click", function() {
                    //                 startTimer();
                    //                 });
// ====================================================================================================

            $("#attack-btn").on("click", function () {
                var timer;
                    //I spent 6-7 consecutive hours here
                 timer = setTimeout (function() {
                    
                    $('#narrator').text('');
                    $('#narrator').append(heroChar.name + "  deals " + heroChar.attackPower + " points of damage!");
                    $("#attack-btn").attr("disabled","disabled");
                    $("#attack-btn").removeClass("on");
                    $("#attack-btn").addClass("off");


                    function heroTackle(){
                        $("#heroImg").addClass("heroTackle");
                        $("#enemyDMG").attr("src", "assets/images/boom.png");
                    }
                    setTimeout(heroTackle, 1000);


                    function heroReturn(){
                        $("#enemyDMG").removeAttr("src", "assets/images/boom.png");
                        $("#heroImg").removeClass("heroTackle");
                        enemyChar.currentHitPoints = enemyChar.currentHitPoints - heroChar.attackPower;
                        $("#enemyHPBar").val(enemyChar.currentHitPoints);
                    }
                    setTimeout(heroReturn, 1500);
                    console.log(timer);

                    function attackUp(){
                        heroChar.attackPower = heroChar.attackPower + heroChar.baseAttackIncrement;
                        $('#narrator').text('');
                        $('#narrator').append(heroChar.name + "'\s attack power increases to " + heroChar.attackPower + "!");

                    }
                    setTimeout(attackUp, 2500);


                    function enemyAttack(){
                        
                        $('#narrator').text('');
                        $('#narrator').prepend("Enemy ").append(enemyChar.name + " counter-attacks for " + enemyChar.counterAttack +  " damage!");
                        beatEnemyCheck();
                        winCheck();
                    }
                    setTimeout(enemyAttack, 4000);


                    function enemyTackle(){
                        $("enemyImg").addClass("enemyTackle");
                        $("#heroDMG").attr("src", "assets/images/boom.png");
                    }
                    setTimeout(enemyTackle, 5000);


                    function enemyReturn(){
                            $("#heroDMG").removeAttr("src", "assets/images/boom.png");
                            $("#enemyImg").removeClass("enemyTackle");
                                //this is the enemy damaging the hero and  HP bar lowering to reflect new HP
                            heroChar.currentHitPoints = heroChar.currentHitPoints - enemyChar.counterAttack;
                            $("#heroHPBar").val(heroChar.currentHitPoints);
                            lossCheck();
                        }
                    setTimeout(enemyReturn, 5500);


                    function newTurn() {
                        $('#narrator').text('');
                        $('#narrator').append(heroChar.name + ' may now attack again!');
                        $("#attack-btn").removeAttr("disabled","disabled");
                        $("#attack-btn").removeClass("off");
                        $("#attack-btn").addClass("on");
                            //this turns the attack button back on, so you can attack again.
                    }
                    setTimeout(newTurn, 6500); 
                    
                });
                
            });
        }

        lossCheck = function() {
            if (heroChar.currentHitPoints <= 0 && enemyChar.currentHitPoints >=0) {
                // clearTimeout(timer);
                hideScenes();
                $('#winOrLose').html(''); 
                $('#winOrLose').html('<h1>RESULTS</h1>');
                $('#winOrLose').removeClass('hidden');
                $("#winOrLose").addClass('loss');
                $('#winOrLose').append("<br><br><br><h1>YOU LOST!<br><br> Click anywhere to play again!</h1>");
                $("#winOrLose").on("click", function() {
                    location.reload();
                });
            }
        }

        winCheck = function() {
            if (heroChar.currentHitPoints >=0 && characterBulbasaur.chosenOrDefeated == true && characterPorygon2.chosenOrDefeated == true && characterGengar.chosenOrDefeated == true && characterMewtwo.chosenOrDefeated == true ) {
                clearTimeout(startTurn);
                hideScenes();
                $('#winOrLose').removeClass('hidden');
                $("#winOrLose").addClass('win');
                $('#winOrLose').html("");
                $('#winOrLose').html("<h1>RESULTS</h1><br><br><br><h1>You won!<br><br> You defeated EVERY enemy!<br> Click anywhere to play again!</h1>");
                $("#winOrLose").on("click", function() {
                    location.reload();
                });
            }
        }

        beatEnemyCheck = function() {
            if (enemyChar.currentHitPoints <= 0 && heroChar.currentHitPoints >=0) {
                heroChar.currentHitPoints = heroChar.currentHitPoints + enemyChar.counterAttack;
            //I do this because the enemy would still attack off-screen even if I defeat him. So the Hero's HP
            // is subtracted in between defeating the enemy and loading the next enemy. 
            //I wouldn't have to do this if I could get the timers to clear. But I had no luck after 6 hours or so.
                clearTimeout(startTurn);
                enemyChar.chosenOrDefeated = true;
                hideScenes();
                $('#winOrLose').removeClass('hidden');
                $("#winOrLose").addClass('win');
                $('#winOrLose').html("");
                $('#winOrLose').html("<h1>RESULTS</h1><br><br><br><h1>You defeated the enemy!<br> Click to keep fighting to defeat the<br> remaining enemies!</h1>");
                $("#winOrLose").on("click", function() {
                    getOpponent();
                });
            }
        }

        getHero();
    </script>
    
</body>
</html>
