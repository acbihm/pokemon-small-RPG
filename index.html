<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>RPG Game</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">  
</head>
<body>
    <div id="wrapper">
        <div id="heroSelect" class="gameArea"></div>
        <div id="enemySelect" class="gameArea"></div>
        <div id="encounter" class="gameArea en"></div>
        <div id="arena" class="gameArea"></div>
        <div id="results" class="gameArea"></div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        
        var charBulbasaur = {
            name: "Bulbasaur",
            HP: 110,
            currentHP: 110,  
            atk: 8,        
            baseAtk: 14,  
            cAtk: 11,       
            chosenOrDefeated: false,
            difficulty: "Easy",       
            frontImg: "assets/images/bulbasaur1.gif",
            backImg: "assets/images/bulbasaur2.gif",
            profImg: "assets/images/bulbasaur-profile.png"
        };

        var charPorygon2 = {
            name: "Porygon2",
            HP: 130,
            currentHP: 130,  
            atk: 12,        
            baseAtk: 18,     
            cAtk: 15,          
            chosenOrDefeated: false,
            difficulty: "Hard",      
            frontImg: "assets/images/porygon21.gif",
            backImg: "assets/images/porygon22.gif",
            profImg: "assets/images/porygon2-profile.png",
        };

        var charGengar = {
            name: "Gengar",
            HP: 160,
            currentHP: 160,   
            atk: 16,         
            baseAtk: 24,     
            cAtk: 21,          
            chosenOrDefeated: false,
            difficulty: "Very Hard",       
            frontImg: "assets/images/gengar1.gif",
            backImg: "assets/images/gengar2.gif",
            profImg: "assets/images/gengar-profile.png"
        };

        var charMewtwo = {
            name: "Mewtwo",
            HP: 210,
            currentHP: 210,   
            atk: 20,         
            baseAtk: 26,    
            cAtk: 23,         
            chosenOrDefeated: false,
            difficulty: "Master",
            frontImg: "assets/images/mewtwo1.gif",
            backImg: "assets/images/mewtwo2.gif",
            profImg: "assets/images/mewtwo-profile.png"
        };

        var char = [];
        char[0] = charBulbasaur;
        char[1] = charPorygon2;
        char[2] = charGengar;
        char[3] = charMewtwo;
        var enemyChar;          //will have value assigned multiple times
        var heroChar;           //player's characer
        var getHero;            //the function that lets player select hero
        var getOpponent;        //the function that lets player select opponents
        var encounterFunc;      //the "enemy challenges you" screen
        var battleFunc;         
        var startTurn;
        var hideScenes;
        var lossCheck;
        var beatEnemyCheck;
        var winCheck;
        var timeOff;
        var oneInstanceOfBattle;
        var Object1;            //placeholder/test

        hideScenes = function() {
            $("#heroSelect").addClass('hidden');
            $("#enemySelect").addClass('hidden'); 
            $("#encounter").addClass('hidden');
            $("#arena").addClass('hidden');
            $("#results").addClass('hidden');
        }

// ===++++++==++=++===++=+=+++=====++===++++

        getHero = function() {
            hideScenes();
            $('#heroSelect').html("<h1>Choose your Pokemon!</h1>");
            $('#heroSelect').removeClass('hidden');
            oneInstanceOfBattle = false;
            
            for (var i = 0; i <= 3; i++) {
                var hero = $("<img>");
                hero.addClass("heroes");
                hero.attr('src', char[i].profImg);
                hero.attr('width', "130px");
                hero.attr('height', "130px");
                hero.attr('id', 'heroID' + i);
                $("#heroSelect").append(hero);
            }
            $("#heroID0").on("click", function() {
                heroChar = char[0];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent(heroChar);
                return heroChar;
            });
            $("#heroID1").on("click", function() {
                heroChar = char[1];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent(heroChar);
                return heroChar;
            });
            $("#heroID2").on("click", function() {
                heroChar = char[2];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent(heroChar);
                return heroChar;
            });
            $("#heroID3").on("click", function() {
                heroChar = char[3];
                heroChar.chosenOrDefeated = true;
                hideScenes();
                getOpponent(heroChar);
                return heroChar;
            });
        }

// ========================================================================================================================

        getOpponent = function(hero, a, b, c) {
            hero = heroChar;
            $("#heroSelect").html("");
                //^resets previous scene
            hideScenes();
            $('#enemySelect').html("");
            $('#enemySelect').html("<h1>Choose an opponent!</h1>");      
            $('#enemySelect').removeClass('hidden');
            for (var i = 0; i <= 3; i++) {
                if (char[i].chosenOrDefeated == false){
                    var enemy = $("<img>");
                    enemy.attr('src', char[i].profImg);
                    enemy.attr('width', "130px");
                    enemy.attr('height', "130px");
                    enemy.attr('id', 'enemyID' + i);
                    $("#enemySelect").append(enemy);
                }
            }     
            $("#enemyID0").on("click", function(hero) {
                enemyChar = null;
                enemyChar = char[0];
                hideScenes();
                encounterFunc(enemyChar);
                return enemyChar;
            });
            $("#enemyID1").on("click", function(hero) {
                enemyChar = null;
                enemyChar = char[1];
                hideScenes();
                encounterFunc(enemyChar);
                return enemyChar;
            });
            $("#enemyID2").on("click", function(hero) {
                enemyChar = null;
                enemyChar = char[2];
                hideScenes();
                encounterFunc(enemyChar);
                return enemyChar;
            });
            $("#enemyID3").on("click", function(hero) {
                enemyChar = null;
                enemyChar = char[3];
                hideScenes();
                encounterFunc(enemyChar);;
                return enemyChar;
            });
        }

// ========================================================================================================================

        encounterFunc = function(enemyForEncounter, ) {
            $('#enemySelect').html('');
                //^resets previous scene
            $('#encounter').html("<h1 id='encounterWords'></h1><br><img id='encounterImg'>")
            $('#encounter').removeClass('hidden');
            $('#encounterWords').append("Enemy " + enemyChar.name + " challenges you!");
            $('#encounterImg').attr("src", enemyChar.profImg);
            $('#encounterImg').after("<br><br><br><br><h1 id='encounterWords'>Click anywhere to battle!</h1>");
            $("#encounter").one("click", function() {
                hideScenes();
                if (oneInstanceOfBattle == false) {
                    battleFunc(enemyForEncounter);
                }
                // $('#encounter').removeAttr("id", "enounter");
            });
        }

// ========================================================================================================================

        battleFunc = function(){
            $("#encounter").html("");
            $('#arena').removeClass('hidden');
            $("#arena").html("<div><h3 id='enemyHUD'></h3><progress id='enemyHPBar'></progress><img id='enemyImg'><img id='enemyDMG'></div><div><h3 id='heroHUD'> </h3><progress id='heroHPBar'></progress><img id='heroImg'><img id='heroDMG'><button id='attack-btn' class='on'>ATTACK</button><h4 id='narrator'></h4></div>");
            $("#enemyImg").attr("src", enemyChar.frontImg);
            $("#heroImg").attr("src", heroChar.backImg);
            $("#enemyHUD").html("Enemy " + enemyChar.name + "/'s HP: " + enemyChar.currentHP + "/" + enemyChar.HP);
            $("#heroHUD").html(heroChar.name + "/'s HP: " + heroChar.currentHP + "/" + heroChar.HP);
            $("#heroHPBar").attr("max", heroChar.HP);
            $("#heroHPBar").attr("value", heroChar.currentHP);
            $("#enemyHPBar").attr("max", enemyChar.HP);
            $("#enemyHPBar").attr("value", enemyChar.currentHP);
            $("#attack-btn").bind("click", function () {
                timeOff = setTimeout(function() {
                    $('#narrator').text('');
                    $('#narrator').append(heroChar.name + "  deals " + heroChar.atk + " points of damage!");
                    $("#attack-btn").attr("disabled","disabled");
                    $("#attack-btn").removeClass("on");
                    $("#attack-btn").addClass("off");
                    heroTackle = setTimeout(function() {
                        $("#heroImg").addClass("heroTackle");
                        $("#enemyDMG").attr("src", "assets/images/boom.png");
                    }, 600);
                    heroReturn = setTimeout(function() {
                        $("#enemyDMG").removeAttr("src", "assets/images/boom.png");
                        $("#heroImg").removeClass("heroTackle");
                        enemyChar.currentHP = (enemyChar.currentHP - heroChar.atk);
                        $("#enemyHPBar").val(enemyChar.currentHP);
                        $("#enemyHUD").html("Enemy " + enemyChar.name + "\'s HP: " + enemyChar.currentHP + "/" + enemyChar.HP);
                        // console.log(Object.values(heroChar));
                    }, 1200);
                    attackUp = setTimeout(function() {
                        heroChar.atk = heroChar.atk + heroChar.baseAtk;
                        $('#narrator').text('');
                        $('#narrator').append(heroChar.name + "'\s attack power increases to " + heroChar.atk + "!");
                        console.log(heroChar.atk);
                        
                    }, 2200);
                    enemyAttack = setTimeout(function() {
                        $('#narrator').text('');
                        $('#narrator').prepend("Enemy ").append(enemyChar.name + " counter-attacks for " + enemyChar.cAtk +  " damage!");
                        beatEnemyCheck();
                        winCheck();
                    }, 3200);
                    enemyTackle = setTimeout(function() {
                        $("#enemyImg").addClass("enemyTackle");
                        $("#heroDMG").attr("src", "assets/images/boom.png");
                    }, 3700);
                    enemyReturn = setTimeout(function() {
                        $("#heroDMG").removeAttr("src", "assets/images/boom.png");
                        $("#enemyImg").removeClass("enemyTackle");
                            //this is the enemy damaging the hero and  HP bar lowering to reflect new HP
                        heroChar.currentHP = heroChar.currentHP - enemyChar.cAtk;
                        $("#heroHPBar").val(heroChar.currentHP);
                        $("#heroHUD").html(heroChar.name + "/'s HP: " + heroChar.currentHP + "/" + heroChar.HP);
                        lossCheck();
                    }, 4300);
                    newTurn = setTimeout(function() {
                        $('#narrator').text('');
                        $('#narrator').append(heroChar.name + ' may now attack again!');
                        $("#attack-btn").removeAttr("disabled","disabled");
                        $("#attack-btn").removeClass("off");
                        $("#attack-btn").addClass("on");
                            //this turns the attack button back on, so you can attack again.
                    }, 5300);
                    test = setTimeout(function() {
                        clearTimeout(newTurn);
                    }, 5301);
                });     //ms can go here
            });     //end of on click       MS CAN GO HERE
        }//end of battle function

// ========================================================================================================================

        lossCheck = function() {
            if (heroChar.currentHP <= 0 && enemyChar.currentHP >=0) {
                hideScenes();
                $('#results').html(''); 
                $('#results').html('<h1>RESULTS</h1>');
                $('#results').removeClass('hidden');
                $('#results').addClass('loss');
                $('#results').append("<br><br><br><h1>YOU LOST!<br><br> Click anywhere to play again!</h1>");
                $('#results').on("click", function() {
                    location.reload();
                });
            }
        }

// ========================================================================================================================

        winCheck = function() {
            if (heroChar.currentHP >=0 && charBulbasaur.chosenOrDefeated == true && charPorygon2.chosenOrDefeated == true && charGengar.chosenOrDefeated == true && charMewtwo.chosenOrDefeated == true ) {
                hideScenes();
                $('#results').removeClass('hidden');
                $('#results').addClass('win');
                $('#results').html("");
                $('#results').html("<h1>RESULTS</h1><br><br><br><h1>You won!<br><br> You defeated EVERY enemy!<br> Click anywhere to play again!</h1>");
                $('#results').on("click", function() {
                    location.reload();
                });
            }
            else {
                return;
            }
        }

// ========================================================================================================================

        beatEnemyCheck = function() {
            if (enemyChar.currentHP <= 0 && heroChar.currentHP >=0) {
                heroChar.currentHP = heroChar.currentHP + enemyChar.cAtk;
                enemyChar.chosenOrDefeated = true;
                hideScenes();
                $('#results').removeClass('hidden');
                $('#results').addClass('win');
                $('#results').html("");
                $('#results').html("<h1>RESULTS</h1><br><br><br><h1>You defeated the enemy!<br> Click to keep fighting to defeat the<br> remaining enemies!</h1>");
                $('#results').on("click", function() {
                    buttt = true;
                    getOpponent();
                    return;    
                });
            }//end of if
        }//beatEnemyCheck

// ========================================================================================================================

        getHero();

        // getHero();
        // getOpponent(heroChar);
    </script>
</body>
</html>
